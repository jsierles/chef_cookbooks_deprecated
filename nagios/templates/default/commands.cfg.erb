# Command definitions
# Automatically generated by Chef

# Host checks

define command {
  command_name    check-host-alive
  command_line    $USER1$/check_ping -H $HOSTADDRESS$ -w 2000,80% -c 3000,100% -p 1
}

# Fortigate Checks

define command {
  command_name  check_fortigate_cpu
  command_line  /u/nagios/plugins/check_cpu.pl -T fg -H $HOSTADDRESS$ -C $ARG1$ -w $ARG2$ -c $ARG3$ 
}

define command {
  command_name  check_fortigate_memory
  command_line  /u/nagios/plugins/check_fortigate_memory.pl -H $HOSTADDRESS$ -C $ARG1$ -w $ARG2$ -c $ARG3$
}

define command{
  command_name   check_fortigate_port
  command_line   $USER1$/check_snmp -H $HOSTADDRESS$ -C $ARG1$ -o IF-MIB::ifOperStatus.$ARG2$ -R up
}

# Cisco Checks

define command{
  command_name   check_cisco_stack
  command_line   /u/nagios/plugins/check_cisco_stack.pl -H $HOSTADDRESS$ -C $ARG1$
}

define command{
  command_name   check_cisco
  command_line   /u/nagios/plugins/check_cisco.pl -h $HOSTADDRESS$ -c $ARG1$ -i $ARG2$ -s up
}

define command {
  command_name  check_cisco_cpu
  command_line  $USER1$/check_snmp -H $HOSTADDRESS$ -C $ARG1$ -o $ARG2$ -w $ARG3$ -c $ARG4$ 
}

# APC Checks

define command{
  command_name   check_apc_load_total
  command_line   $USER1$/check_snmp -H $HOSTADDRESS$ -C $ARG1$ -o 1.3.6.1.4.1.318.1.1.12.2.3.1.1.2.1 -w $ARG2$ -c $ARG3$ 
}

define command{
  command_name   check_apc_load_bank_1
  command_line   $USER1$/check_snmp -H $HOSTADDRESS$ -C $ARG1$ -o 1.3.6.1.4.1.318.1.1.12.2.3.1.1.2.2 -w $ARG2$ -c $ARG3$ 
}

define command{
  command_name   check_apc_load_bank_2
  command_line   $USER1$/check_snmp -H $HOSTADDRESS$ -C $ARG1$ -o 1.3.6.1.4.1.318.1.1.12.2.3.1.1.2.3 -w $ARG2$ -c $ARG3$ 
}

# Isilon Checks

define command{
        command_name    check_snmp_cluster_health
        command_line    $USER1$/check_snmp -H $HOSTADDRESS$ -o .1.3.6.1.4.1.12124.1.1.2.0 -C $ARG1$
}

# Service checks

define command {
  command_name    check_haproxy_queue
  command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_$ARG1$_haproxy_queue -t 20
}

define command {
  command_name    check_file_age
  command_line    $USER1$/check_by_ssh -H $HOSTADDRESS$ -C "<%= @node[:nagios][:plugins_dir] %>/check_file_age.rb -w $ARG1$ -c $ARG2$ -f $ARG3$" -l app
}

define command {
  command_name    check_inverse_file_age
  command_line    $USER1$/check_by_ssh -H $HOSTADDRESS$ -C "<%= @node[:nagios][:plugins_dir] %>/check_file_age.rb -i -w $ARG1$ -c $ARG2$ -f $ARG3$" -l app
}

define command {
  command_name    check_local_file_age
  command_line    $USER1$/check_file_age $ARG1$ -w $ARG2$ -c $ARG3$
}

define command {
  command_name    check_file_count
  command_line    $USER1$/check_by_ssh -H $HOSTADDRESS$ -C "<%= @node[:nagios][:plugins_dir] %>/file_queues.rb -t count -p $ARG1$ -w $ARG2$ -c $ARG3$" -l app
}

define command {
  command_name    check_log
  command_line    $USER1$/check_by_ssh -H $HOSTADDRESS$ -C "/usr/lib/nagios/plugins/check_log -F $ARG1$ -O /tmp/nagios.logcheck.processed -q $ARG2$" -l app
}

define command { 
  command_name    check_highrise_item_age
  command_line    <%= @node[:nagios][:plugins_dir] %>/check_highrise.rb -s $ARG1$ -a $ARG2$ -i $ARG3$ -c $ARG4$ -w $ARG5$
}

define command { 
  command_name    check_mogilefs_bored_workers
  command_line    <%= @node[:nagios][:plugins_dir] %>/check_mogilefs_bored_workers.rb -h $HOSTADDRESS$ -p $ARG1$ -c $ARG2$ -w $ARG3$
}

define command { 
  command_name    check_redis
  command_line    <%= @node[:nagios][:plugins_dir] %>/check_redis.rb $HOSTADDRESS$ $ARG1$
}

define command {
	command_name		check_resque_queue
	command_line    <%= @node[:nagios][:plugins_dir]%>/check_resque_queue.rb -h $HOSTADDRESS$ -w $ARG1$ -c $ARG2$ -q $ARG3$
}

define command { 
  command_name    check_solr
  command_line    $USER1$/check_tcp -H $HOSTADDRESS$ -p 8983
}

define command { 
  command_name    check_solr_ping
  command_line    <%= @node[:nagios][:plugins_dir] %>/check_solr.rb -c 10 -h $HOSTADDRESS$ -r 10 -p $ARG1$ -g
}

define command { 
  command_name    query_solr
  command_line    <%= @node[:nagios][:plugins_dir] %>/check_solr.rb -c 10 -h $HOSTADDRESS$ -r 10 -p $ARG1$ -q $ARG2$
}

define command { 
  command_name    check_solr_alt_port
  command_line    <%= @node[:nagios][:plugins_dir] %>/check_solr.rb -c 10 -h $HOSTADDRESS$ -r 10 -p $ARG1$ -a $ARG2$
}

define command { 
  command_name    query_solr_alt_port
  command_line    <%= @node[:nagios][:plugins_dir] %>/check_solr.rb -c 10 -h $HOSTADDRESS$ -r 10 -p $ARG1$ -q $ARG2$ -a $ARG3$
}

define command { 
  command_name    check_mem
  command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_mem -t 20
} 

define command {
	command_name	check_query_count
	command_line	<%= @node[:nagios][:plugins_dir] %>/db_queues.rb -H $HOSTADDRESS$ -P $ARG1$ -u $ARG2$ -p $ARG3$ -d $ARG4$ -q $ARG5$ -w $ARG6$ -c $ARG7$
}

define command{
  command_name   check_snmp
  command_line   $USER1$/check_snmp -H $HOSTADDRESS$ $ARG1$
}

define command{
        command_name    check_local_disk
        command_line    $USER1$/check_disk -w $ARG1$ -c $ARG2$ -p $ARG3$
        }


define command{
        command_name    check_local_load
        command_line    $USER1$/check_load -w $ARG1$ -c $ARG2$
        }


define command{
        command_name    check_local_procs
        command_line    $USER1$/check_procs -w $ARG1$ -c $ARG2$ -s $ARG3$
        }

define command{
        command_name    check_local_users
        command_line    $USER1$/check_users -w $ARG1$ -c $ARG2$
        }

define command {
  command_name    check_local_log
  command_line    $USER1$/check_log -F $ARG1$ -O /tmp/nagios.logcheck.processed -q $ARG2$
}

define command {
  command_name    check_local_log_multi
  command_line    $USER1$/check_log -F $ARG1$ -O $ARG2$ -q $ARG3$
}

define command{
        command_name    check_dns
        command_line    $USER1$/check_dns -H $ARG1$ -s $HOSTADDRESS$
        }


define command{
        command_name    check_ftp
        command_line    $USER1$/check_ftp -H $HOSTADDRESS$
        }


define command{
        command_name    check_hpjd
        command_line    $USER1$/check_hpjd -H $HOSTADDRESS$ -C public
        }

define command {
        command_name    check_http_content
        command_line    $USER1$/check_http -I $HOSTADDRESS$ -H $ARG1$ -u $ARG2$ -s $ARG3$ -f follow
        }

define command {
        command_name    check_https_content
        command_line    $USER1$/check_http -I $HOSTADDRESS$ -H $ARG1$ -u $ARG2$ -s $ARG3$ -f follow -S
        }

define command {
        command_name    check_https_api
        command_line    $USER1$/check_http -H $ARG1$ --ssl -a $ARG2$:X -u $ARG3$
        }
        
define command {
        command_name    check_http_content_alt_ip
        command_line    $USER1$/check_http -I $ARG1$ -H $ARG2$ -u $ARG3$ -s $ARG4$ -f follow
        }

define command {
        command_name    check_https_content_alt_ip
        command_line    $USER1$/check_http -I $ARG1$ -H $ARG2$ -u $ARG3$ -s $ARG4$ -f follow -S
        }

define command {
      command_name    check_unauthorized_https_content
      command_line    $USER1$/check_http -I $HOSTADDRESS$ -H $ARG1$ -u $ARG2$ -s $ARG3$ -f follow -e 401 -S
      }
      
define command {
      command_name    check_http_basic_auth
      command_line    $USER1$/check_http -I $HOSTADDRESS$ -H $ARG1$ -u $ARG2$ -s $ARG3$ -a $ARG4$
      }

define command {
      command_name    check-host-alive-by-http
      command_line    $USER1$/check_tcp -H $HOSTADDRESS$ -p 80
}

define command {
      command_name    check-ip-alive-by-http
      command_line    $USER1$/check_tcp -H $ARG1$ -p 80
}

define command {
      command_name    check-host-alive-by-https
      command_line    $USER1$/check_tcp -H $HOSTADDRESS$ -p 443
}

define command {
      command_name    check-host-alive-by-ssh
      command_line    $USER1$/check_ssh -H $HOSTADDRESS$
}

define command {
        command_name    check_https_image_content
        command_line    $USER1$/check_http -I $HOSTADDRESS$ -H $ARG1$ -u $ARG2$ -f follow -S
        }

define command {
        command_name    check_http_image_content_with_port
        command_line    $USER1$/check_http -I $HOSTADDRESS$ -H $ARG1$ -u $ARG2$ -p $ARG3$ -f follow
        }

define command{
        command_name    check_campfire_poller
        command_line    $USER1$/check_http -I $HOSTADDRESS$ -p 2345 -u /stats -w 2 -c 3 -N
	}

define command{
       command_name    check_mongrel_http_content
       command_line    $USER1$/check_http -I $HOSTADDRESS$ -H $ARG1$ -u $ARG2$ -s $ARG3$ -p $ARG4$
       }

define command{
			command_name check_http_error_rate
			command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_$ARG1$_http_log_error_rate -t 60
			}

define command{
			command_name check_exceptions_error_rate
			command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_exceptions_log_error_rate
			}
			
define command{
			command_name killed_proc_log_check
			command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c killed_proc_log_check -t 60
			}
			
define command{
			command_name mysql_exceptions_log_check
			command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c mysql_exceptions_log_check
			}

define command{
        command_name    check_nntp
        command_line    $USER1$/check_nntp -H $HOSTADDRESS$
        }


define command{
        command_name    check_ping
        command_line    $USER1$/check_ping -H $HOSTADDRESS$ -w $ARG1$ -c $ARG2$ -p 5
        }

define command{
        command_name    check_pop
        command_line    $USER1$/check_pop -H $HOSTADDRESS$
        }

define command{
        command_name    check_smtp
        command_line    $USER1$/check_smtp -H $HOSTADDRESS$
        }

define command{
        command_name    check_smtp_relay
        command_line    $USER1$/check_smtp -H $HOSTADDRESS$ -e ESMTP -C "MAIL FROM: nagios@37signals.com" -R "250" -C "RCPT TO: system@highrisehq.com" -R "250"
        }

define command{
	command_name	check_tcp
	command_line	$USER1$/check_tcp -H $HOSTADDRESS$ -p $ARG1$
	}

define command{
	command_name	check_ssh
	command_line	$USER1$/check_ssh $HOSTADDRESS$
	}

define command{
        command_name    check_telnet
        command_line    $USER1$/check_tcp -H $HOSTADDRESS$ -p 23
}

define command{
	command_name	check_udp
	command_line	$USER1$/check_udp -H $HOSTADDRESS$ -p $ARG1$
}

# 'check_mysql' check mysql connectivity

define command{
	command_name	check_mysql
	command_line	$USER1$/check_mysql -H $ARG1$ -u nagios -p $ARG2$
}


# 'check_mysqlrep' command for mysql replication status
# 

define command { 
	command_name    check_replication
	command_line    $USER1$/check_nrpe -c check_replication -H $HOSTADDRESS$ -t 20
	
}

define command {
	command_name	check_mysqlrep
	command_line	<%= @node[:nagios][:plugins_dir] %>/check-mysql-slave.pl --host $HOSTADDRESS$ --port $ARG1$ --user replcheck --password $ARG2$ --warn $ARG3$ --crit $ARG4$
}

define command {
	command_name	check_mysql_uptime
	command_line	<%= @node[:nagios][:plugins_dir] %>/check_mysql_health --host $HOSTADDRESS$ --port $ARG1$ --user replcheck --password $ARG2$ --mode=uptime
}

define command {
	command_name	check_mysql_long_procs
	command_line	<%= @node[:nagios][:plugins_dir] %>/check_mysql_health --host $HOSTADDRESS$ --port $ARG1$ --user replcheck --password $ARG2$ --mode=long-running-procs
}

define command {
	command_name	check_mysql_slave_warmer
	command_line	<%= @node[:nagios][:plugins_dir] %>/check_mysql_slave_warmer.rb -H $HOSTADDRESS$ -P $ARG1$ -u replcheck -p $ARG2$ -m $ARG3$ -d $ARG4$
}

define command {
	command_name	check_mysql_readonly
	command_line	<%= @node[:nagios][:plugins_dir] %>/check_mysql_readonly.rb -H $HOSTADDRESS$ -P $ARG1$ -u replcheck -p $ARG2$
}

define command {
	command_name	check_mysql_slave_lag
	command_line	<%= @node[:nagios][:plugins_dir] %>/check_mysql_health --host $HOSTADDRESS$ --port $ARG1$ --user replcheck --password $ARG2$ --mode=slave-lag
}

define command {
	command_name	check_mysql_lock_contention
	command_line	<%= @node[:nagios][:plugins_dir] %>/check_mysql_health --host $HOSTADDRESS$ --port $ARG1$ --user replcheck --password $ARG2$ --mode=table-lock-contention
}

define command {
	command_name	check_blacklist
	command_line	<%= @node[:nagios][:plugins_dir] %>/check_bl_async.pl -H $HOSTADDRESS$ -B $ARG1$ -c $ARG2$
}

# -t 3600 -> 60 minutes. Currently basecamp lzop -t takes about 45 minutes
define command {
	command_name check_lzop_backup_integrity
	command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_$ARG1$_lzop_backup_integrity -t 3600
}

define command {
	command_name check_mysql_backup_file_size
	command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_$ARG1$_mysql_backup_file_size
}

# Dell OM checks

define command {
  command_name dell_check_controller_battery_learn_state
  command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c dell_check_controller_battery_learn_state
}

define command {
  command_name dell_check_controller_battery_next_learn_time
  command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c dell_check_controller_battery_next_learn_time
}

# nrpe remote host checks

define command{ 
	command_name    check_nrpe_alive 
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -t 20
	} 

define command{ 
	command_name    check_nrpe 
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c $ARG1$ -t 20
	} 

define command{ 
	command_name    check_load
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_load -t 20
} 

define command{ 
	command_name    check_disk
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_$ARG1$ -t 20
} 

define command{ 
	command_name    check_all_disks
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_all_disks -t 20
} 

define command{ 
	command_name    check_traffic
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c traffic -t 20
}

define command{ 
	command_name    check_iowait_time
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_iowait_time -t 20
} 

define command{ 
	command_name    check_tps
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_tps -t 20
} 

define command{ 
	command_name    check_swap
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_swap -t 20
} 

define command{ 
	command_name    check_solr_index
	command_line    $USER1$/check_nrpe -H $HOSTADDRESS$ -c check_$ARG1$_solr_index -t 20
} 

define command{ 
	command_name    check_mysql_health
	command_line    /u/nagios/plugins/check_mysql_health --hostname $HOSTADDRESS$ --username $ARG1$ --password $ARG2$ --port $ARG3$ --mode $ARG4$ --warning $ARG5$ --critical $ARG6$
} 

define command {
  command_name  bc_check_unicorn_processes
  command_line  $USER1$/check_nrpe -H $HOSTADDRESS$ -c bc_unicorn_detect_old_processes -t 30
}

# dummy commands for passive checks

define command{
	command_name	no-disk-checks
	command_line	/usr/local/nagios/libexec/check_dummy 2 "CRITICAL: Results of disk checks not coming in!"
}
	
define command{
	command_name	no-mem-checks
	command_line	/usr/local/nagios/libexec/check_dummy 2 "CRITICAL: Results of memory checks not coming in!"
}
	
# Notification


define command {
  command_name  host-notify-by-email
  command_line  /usr/bin/printf "%b" "$LONGDATETIME$\n\n$HOSTALIAS$ $NOTIFICATIONTYPE$ $HOSTSTATE$\n\n$HOSTOUTPUT$\n\n" | /bin/mail -s "$NOTIFICATIONTYPE$ - $HOSTALIAS$ $HOSTSTATE$! : $NOTIFICATIONCOMMENT$" $CONTACTEMAIL$
}


define command{
  command_name  host-notify-by-campfire
  command_line  <%= @node[:nagios][:notifiers_dir] %>/campfire -s 37s -r "<%= @campfire[:room] %>" -S -t <%= @campfire[:api_token] %> -m "$HOSTALIAS$ $HOSTSTATE$ $NOTIFICATIONTYPE$ $HOSTSTATE$ $HOSTOUTPUT$ : $NOTIFICATIONCOMMENT$"

}

define command{
  command_name  host-notify-by-jabber
  command_line  <%= @node[:nagios][:notifiers_dir] %>/jabber -j $CONTACTADDRESS1$ -m "$HOSTALIAS$ $HOSTSTATE$ $NOTIFICATIONTYPE$ $HOSTSTATE$ $HOSTOUTPUT$ : $NOTIFICATIONCOMMENT$"

}

define command{
  command_name  host-notify-by-sms-email
  command_line  /usr/bin/printf "%b" "$HOSTALIAS$ $NOTIFICATIONTYPE$ $HOSTSTATE$\n\n$HOSTOUTPUT$" | /bin/mail -s "$HOSTALIAS$ $HOSTSTATE$! : $NOTIFICATIONCOMMENT$" $CONTACTPAGER$

}

# 'notify-by-email' command definition
define command{
  command_name  service-notify-by-email
  command_line  /usr/bin/printf "%b" "$LONGDATETIME$ - $SERVICEDESC$ $SERVICESTATE$\n\n$HOSTALIAS$  $NOTIFICATIONTYPE$\n\n$SERVICEOUTPUT$\n\n$NOTIFICATIONCOMMENT$" | /bin/mail -s "** $NOTIFICATIONTYPE$ - $HOSTALIAS$ - $SERVICEDESC$ - $SERVICESTATE$" $CONTACTEMAIL$
}


define command {
  command_name  service-notify-by-campfire
  command_line   <%= @node[:nagios][:notifiers_dir] %>/campfire -s 37s -r "<%= @campfire[:room] %>" -S -t <%= @campfire[:api_token] %> -m "$SERVICEDESC$ $SERVICESTATE$ $HOSTALIAS$ $NOTIFICATIONTYPE$ $SERVICEOUTPUT$ : $NOTIFICATIONCOMMENT$"

}

define command{
  command_name  service-notify-by-sms-email
  command_line  /usr/bin/printf "%b" "$SERVICEDESC$ $SERVICESTATE$ $HOSTNAME$ $NOTIFICATIONTYPE$ $SERVICEOUTPUT$ : $NOTIFICATIONCOMMENT$" | /bin/mail -s "" $CONTACTPAGER$
  }
g
define command {
  command_name  service-notify-by-jabber
  command_line  <%= @node[:nagios][:notifiers_dir] %>/jabber -j $CONTACTADDRESS1$ -m "$SERVICEDESC$ $SERVICESTATE$ $HOSTALIAS$ $NOTIFICATIONTYPE$ $SERVICEOUTPUT$ : $NOTIFICATIONCOMMENT$"
}

define command {
  command_name  service-notify-ether
  command_line  /usr/bin/curl -X POST -d 'nagios_alert[description]=$SERVICEDESC$&nagios_alert[state]=$SERVICESTATE$&nagios_alert[host_alias]=$HOSTALIAS$&nagios_alert[notification_type]=$NOTIFICATIONTYPE$&nagios_alert[output]=$SERVICEOUTPUT$&nagios_alert[notification_comments]=$NOTIFICATIONCOMMENT$&nagios_alert[type]=service' http://ether.sc-chi-int.37signals.com/nagios_alerts
}

define command {
  command_name  host-notify-ether
  command_line  /usr/bin/curl -X POST -d 'nagios_alert[state]=$HOSTSTATE$&nagios_alert[host_alias]=$HOSTALIAS$&nagios_alert[notification_type]=$NOTIFICATIONTYPE$&nagios_alert[output]=$HOSTOUTPUT$&nagios_alert[notification_comments]=$NOTIFICATIONCOMMENT$&nagios_alert[type]=host' http://ether.sc-chi-int.37signals.com/nagios_alerts
}